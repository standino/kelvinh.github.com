<!DOCTYPE html>
<html lang="en-us">
<head>
  <title>基于saiku开发OLAP应用 - Keep going</title>
  <meta charset="utf-8" />
  <meta name="author" content="Will" />
    <meta name="description" content="使用saiku开发OLAP系统" />
    <meta name="keywords" content="saiku" />

  <link rel="stylesheet" href="http://standino.github.io/media/css/main.css" type="text/css">
  <link rel="stylesheet" href="http://standino.github.io/media/css/prettify.css" type="text/css">

  <link rel="stylesheet" href="/media/css/prettify.css" type="text/css">
  <link rel="stylesheet" href="/media/css/main.css" type="text/css">

  <link rel="stylesheet" href="../../../media/css/main.css" type="text/css">
  <link rel="stylesheet" href="../../../media/css/prettify.css" type="text/css">

</head>
  <body class="container">
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="/">Keep going</a></h1>
        <p>努力超越自己！</p>
        <ul>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/html/">Html</a></li>
          <li><a href="/media/">Media</a></li>
          <li><a href="/tags/">Tags</a></li>
          <li><a href="/wiki/">Wiki</a></li>
          <li><a href="/tags/">Tags</a></li>
          <li><a href="/about/">About</a></li>
          <li><a href="https://github.com/standino">GitHub</a></li>
          <li><a href="/rss.xml">RSS</a></li>
        </ul>
        <form method="get" id="searchform" action="http://www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="q" value="site:standino.github.io">
        </form>
      </header>
    </div>

<div>
<div class="post">
<h1>基于saiku开发OLAP应用</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">OLAP 介绍</a>
<ul>
<li><a href="#sec-1-1">逻辑概念</a></li>
<li><a href="#sec-1-2">星形结构</a></li>
</ul>
</li>
<li><a href="#sec-2">Mondrian 介绍</a></li>
<li><a href="#sec-3">编写 Mondrian Schema</a>
<ul>
<li><a href="#sec-3-1">Cube</a></li>
<li><a href="#sec-3-2">权限</a></li>
<li><a href="#sec-3-3">例子</a></li>
</ul>
</li>
<li><a href="#sec-4">Saiku介绍</a></li>
<li><a href="#sec-5">Saiku 基本配置</a>
<ul>
<li><a href="#sec-5-1">Schema 文件</a></li>
<li><a href="#sec-5-2">连接数据库</a></li>
<li><a href="#sec-5-3">自定义角色</a></li>
</ul>
</li>
<li><a href="#sec-6">saiku 插件编写</a>
<ul>
<li><a href="#sec-6-1">SaikuChartPlus  </a></li>
</ul>
</li>
<li><a href="#sec-7">Saiku用户手册</a>
<ul>
<li><a href="#sec-7-1">选择报表</a></li>
<li><a href="#sec-7-2">添加维度</a></li>
<li><a href="#sec-7-3">执行查询</a></li>
<li><a href="#sec-7-4">交换数轴</a></li>
<li><a href="#sec-7-5">排序</a></li>
<li><a href="#sec-7-6">筛选</a></li>
<li><a href="#sec-7-7">保存报表</a></li>
<li><a href="#sec-7-8">打开已保存的报表</a></li>
<li><a href="#sec-7-9">生成图表</a></li>
</ul>
</li>
<li><a href="#sec-8">参考资料</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">OLAP 介绍</h2>
<div class="outline-text-2" id="text-1">
<p>
Online analytical processing(OLAP)即 联机分析处理 。
</p>

<p>
联机分析处理（OLAP）系统是数据仓库系统最主要的应用，专门设计用于支持复杂的分析操作，侧重对决策人员和高层管理人员的决策支持，可以根
据分析人员的要求快速、灵活地进行大数据量的复杂查询处理，并且以一种直观而易懂的形式将查询结果提供给决策人员，以便他们准确掌握企业
（公司）的经营状况，了解对象的需求，制定正确的方案。
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">逻辑概念</h3>
<div class="outline-text-3" id="text-1-1">
<ol class="org-ol">
<li>维（Dimension）：是人们观察数据的特定角度，是考虑问题时的一类属性，属性集合构成一个维（时间维、地理维等）。
</li>
<li>维的层次（Level）：人们观察数据的某个特定角度（即某个维）还可以存在细节程度不同的各个描述方面（时间维：日期、月份、季度、年）。
</li>
<li>维的成员（Member）：维的一个取值，是数据项在某维中位置的描述。（“某年某月某日”是在时间维上位置的描述）。
</li>
<li>度量（Measure）：多维数组的取值。（2000年1月，上海，笔记本电脑，0000）。
</li>
<li>OLAP的基本多维分析操作有钻取（Drill-up和Drill-down）、切片（Slice）和切块（Dice）、以及旋转（Pivot）等。
</li>
<li>钻取：是改变维的层次，变换分析的粒度。它包括向下钻取（Drill-down）和向上钻取（Drill-up）/上卷(Roll-up)。Drill-up是在某一维上将低层次的细节数据概括到高层次的汇总数据，或者减少维数；而Drill-down则相反，它从汇总数据深入到细节数据进行观察或增加新维。
</li>
<li>切片和切块：是在一部分维上选定值后，关心度量数据在剩余维上的分布。如果剩余的维只有两个，则是切片；如果有三个或以上，则是切块。
</li>
<li>旋转：是变换维的方向，即在表格中重新安排维的放置（例如行列互换）。
</li>
</ol>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">星形结构</h3>
<div class="outline-text-3" id="text-1-2">
<p>
事实(Fact)和维(Dimension)         当我们观察数据时，通常想察看聚合数据的某种顺序。这些数据叫做度量(measure)。度量就是可以度量和相
加的数值。比如销售金额就是一种度量，每个订单都有销售金额。假设每天销售20个产品，每个5美元，销售总额就是100美元。销售金额就是我们想
关注的一种度量。此外我们可能还想知道当天的顾客数，是5位顾客一共买了20个产品，还是1位顾客买了所有的20个产品呢？销售金额和顾客数量就
是我们想关注的两个度量。        仅仅关心度量还不够。我们观察度量的时候都需要”by”条件。这些”by”条件就叫做维(dimension)。讨论销
售金额的时候，总要指定是某一天，某个季度或者某年的销售金额。几乎我们关心的任何度量都离不开时间维。我们可能还想按照产品名称或者产品
类型查看销售金额，这些条件都要对应到相应的维上。
        由上可知，设计星型数据库的时候，我们首先要确定我们想看什么信息(确定度量)，如何看这些信息(确定维)。
</p>


<p>
当我们开始创建维表的时候，有一些规则要牢记在心。第一，所有维表都要有一个基于单列的主键。这一主键列通常只是一标识列，包含自动递增的
数值，并没有真正的含义。有含义的信息都在其他列中，这些列包含了我们要查看的所有描述信息。比如在产品维中，包含了产品描述、类别、子类
等等。这些字段不能用来作为连接字段和其他表关联，但是包含了产品的所有描述信息。维表通常都比较胖，因为字段都比较多，每一字段都比较宽
</p>

<p>
创建事实表(Fact Table)
        事实表存放度量(measure)信息，或者称事实(fact)信息。度量是根据各个维计算出来的一些数值。比如说销售金额是个数值，我们可以按产品、安类型查看总数，可以查看任何时间段的所有总数。
        跟维表的又矮又胖相比，事实表一般显得又高又瘦。事实表很高，是因为他们拥有的记录数一般都很巨大。
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Mondrian 介绍</h2>
<div class="outline-text-2" id="text-2">
<p>
Mondrian是一个BI开源项目。一个用Java写成的OLAP（在线分析性处理）引擎。它用MDX语言实现查询，从关系数据库(RDBMS)中读取数据。然后经过Java API用多维的方式对结果进行展示。
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">编写 Mondrian Schema</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">Cube</h3>
<div class="outline-text-3" id="text-3-1">
<p>
创建数据立文体（CUBE）。在Mondrian里面的cube是以XML的形式定义的，他有一个GUI工具workbench来制作cube.具体例子见下节中的例子。
</p>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">权限</h3>
<div class="outline-text-3" id="text-3-2">
<p>
权限分为两种，一种是顶一下在Mondrian的cube中。可以设置cube，维度和度量的权限，具体例子见下节中的例子。另一种是数据权限，这个需要编写Java类实现。具体例子将在下面saiku相关小节进行介绍。
</p>
</div>
</div>



<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3">例子</h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">

<pre class="src src-xml">&lt;Schema name="Sone"&gt;
  &lt;Cube name="userInfo" caption="%{cube.user.info}" visible="true" cache="true" enabled="true"&gt;
    &lt;Table name="factUserInfo"&gt;
    &lt;/Table&gt;
    &lt;Dimension visible="true" foreignKey="gender" highCardinality="false" name="Gender" caption="%{compensation.dimension.gender.caption}"&gt;
      &lt;Hierarchy visible="true" hasAll="true" allMemberName="All Genders" primaryKey="value"&gt;
        &lt;Table name="dimGender"&gt;
        &lt;/Table&gt;
        &lt;Level name="Gender" visible="true" column="name" type="String" uniqueMembers="true" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
      &lt;/Hierarchy&gt;
    &lt;/Dimension&gt;
    &lt;Measure name="Count Person" column="userId" datatype="Integer" formatString="#,###" aggregator="count"&gt;
    &lt;/Measure&gt;
  &lt;/Cube&gt;
  &lt;Cube name="&amp;#37319;&amp;#38144;&amp;#36130;&amp;#21153;&amp;#22823;&amp;#34920;" caption="&amp;#37319;&amp;#38144;&amp;#36130;&amp;#21153;&amp;#22823;&amp;#34920;" visible="true" description="&amp;#37319;&amp;#38144;&amp;#36130;&amp;#21153;&amp;#22823;&amp;#34920;" cache="true" enabled="true"&gt;
    &lt;Table name="fact_sales_money"&gt;
    &lt;/Table&gt;
    &lt;Dimension type="StandardDimension" visible="true" foreignKey="dim_department_id" highCardinality="false" name="&amp;#37096;&amp;#38376;"&gt;
      &lt;Hierarchy visible="true" hasAll="true" allMemberName="&amp;#25152;&amp;#26377;&amp;#37096;&amp;#38376;" primaryKey="dim_department_id"&gt;
        &lt;Table name="dim_department"&gt;
        &lt;/Table&gt;
        &lt;Level name="&amp;#19968;&amp;#32423;&amp;#37096;&amp;#38376;" visible="true" column="dept_level_1" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
        &lt;Level name="&amp;#20108;&amp;#32423;&amp;#37096;&amp;#38376;" visible="true" column="dept_level_2" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
        &lt;Level name="&amp;#19977;&amp;#32423;&amp;#37096;&amp;#38376;" visible="true" column="dept_level_3" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
        &lt;Level name="&amp;#19968;&amp;#32423;&amp;#23703;&amp;#20301;" visible="true" column="position_level_1" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
        &lt;Level name="&amp;#20108;&amp;#32423;&amp;#23703;&amp;#20301;" visible="true" column="position_level_2" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
        &lt;Level name="&amp;#19977;&amp;#32423;&amp;#23703;&amp;#20301;" visible="true" column="position_level_3" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
      &lt;/Hierarchy&gt;
    &lt;/Dimension&gt;
    &lt;Dimension type="StandardDimension" visible="true" foreignKey="dim_vendor_id" highCardinality="false" name="&amp;#20379;&amp;#24212;&amp;#21830;"&gt;
      &lt;Hierarchy visible="true" hasAll="true" allMemberName="&amp;#25152;&amp;#26377;&amp;#20379;&amp;#24212;&amp;#21830;" primaryKey="dim_vendor_id"&gt;
        &lt;Table name="dim_vendor"&gt;
        &lt;/Table&gt;
        &lt;Level name="&amp;#20379;&amp;#24212;&amp;#21830;&amp;#31616;&amp;#30721;" visible="true" column="vendor_code" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
        &lt;Level name="&amp;#20379;&amp;#24212;&amp;#21830;&amp;#21517;&amp;#31216;" visible="true" column="vendor_name" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
      &lt;/Hierarchy&gt;
    &lt;/Dimension&gt;
    &lt;Dimension type="StandardDimension" visible="true" foreignKey="dim_brand_id" highCardinality="false" name="&amp;#21697;&amp;#29260;"&gt;
      &lt;Hierarchy visible="true" hasAll="true" allMemberName="&amp;#25152;&amp;#26377;&amp;#21697;&amp;#29260;" primaryKey="dim_brand_id"&gt;
        &lt;Table name="dim_brand"&gt;
        &lt;/Table&gt;
        &lt;Level name="&amp;#21697;&amp;#29260;ID" visible="true" column="brand_id" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
        &lt;Level name="&amp;#21697;&amp;#29260;&amp;#21517;&amp;#31216;" visible="true" column="brand_name" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
      &lt;/Hierarchy&gt;
    &lt;/Dimension&gt;
    &lt;Dimension type="StandardDimension" visible="true" foreignKey="dim_categories_id" highCardinality="false" name="&amp;#20998;&amp;#31867;"&gt;
      &lt;Hierarchy visible="true" hasAll="true" allMemberName="&amp;#25152;&amp;#26377;&amp;#20998;&amp;#31867;" primaryKey="dim_categories_id"&gt;
        &lt;Table name="dim_categories"&gt;
        &lt;/Table&gt;
        &lt;Level name="&amp;#19968;&amp;#32423;&amp;#20998;&amp;#31867;&amp;#32534;&amp;#30721;" visible="true" column="code_level_1" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
        &lt;Level name="&amp;#19968;&amp;#32423;&amp;#20998;&amp;#31867;&amp;#21517;&amp;#31216;" visible="true" column="name_level_1" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
        &lt;Level name="&amp;#20108;&amp;#32423;&amp;#20998;&amp;#31867;&amp;#32534;&amp;#30721;" visible="true" column="code_level_2" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
        &lt;Level name="&amp;#20108;&amp;#32423;&amp;#20998;&amp;#31867;&amp;#21517;&amp;#31216;" visible="true" column="name_level_2" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
        &lt;Level name="&amp;#19977;&amp;#32423;&amp;#20998;&amp;#31867;&amp;#32534;&amp;#30721;" visible="true" column="code_level_3" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
        &lt;Level name="&amp;#19977;&amp;#32423;&amp;#20998;&amp;#31867;&amp;#21517;&amp;#31216;" visible="true" column="name_level_3" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
      &lt;/Hierarchy&gt;
    &lt;/Dimension&gt;
    &lt;Dimension type="StandardDimension" visible="true" foreignKey="dim_form_type_id" highCardinality="false" name="&amp;#34920;&amp;#21333;&amp;#31867;&amp;#22411;"&gt;
      &lt;Hierarchy visible="true" hasAll="true" allMemberName="&amp;#25152;&amp;#26377;&amp;#34920;&amp;#21333;" primaryKey="dim_form_type_id"&gt;
        &lt;Table name="dim_form_type"&gt;
        &lt;/Table&gt;
        &lt;Level name="&amp;#34920;&amp;#21333;&amp;#31867;&amp;#22411;" visible="true" column="form_type" type="String" uniqueMembers="false" levelType="Regular" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
      &lt;/Hierarchy&gt;
    &lt;/Dimension&gt;
    &lt;Dimension type="TimeDimension" visible="true" foreignKey="dim_time_id" highCardinality="false" name="&amp;#26102;&amp;#38388;"&gt;
      &lt;Hierarchy visible="true" hasAll="true" allMemberName="&amp;#25152;&amp;#26377;&amp;#26102;&amp;#38388;" primaryKey="dim_time_id"&gt;
        &lt;Table name="dim_time"&gt;
        &lt;/Table&gt;
        &lt;Level name="&amp;#24180;" visible="true" column="dim_year" type="String" uniqueMembers="false" levelType="TimeYears" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
        &lt;Level name="&amp;#26376;" visible="true" column="dim_month" type="String" uniqueMembers="false" levelType="TimeMonths" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
        &lt;Level name="&amp;#26085;" visible="true" column="dim_day" type="String" uniqueMembers="false" levelType="TimeDays" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
        &lt;Level name="&amp;#23395;&amp;#24230;" visible="true" column="quarter" type="String" uniqueMembers="false" levelType="TimeQuarters" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
        &lt;Level name="&amp;#21608;" visible="true" column="week" type="String" uniqueMembers="false" levelType="TimeWeeks" hideMemberIf="Never"&gt;
        &lt;/Level&gt;
      &lt;/Hierarchy&gt;
    &lt;/Dimension&gt;
    &lt;Measure name="&amp;#26410;&amp;#32467;&amp;#31639;&amp;#37329;&amp;#39069;" column="outstanding_amount" datatype="Numeric" formatString="#,###" aggregator="sum" visible="true"&gt;
    &lt;/Measure&gt;
    &lt;Measure name="&amp;#24050;&amp;#32467;&amp;#31639;&amp;#37329;&amp;#39069;" column="settlement_amount" datatype="Numeric" formatString="#,###" aggregator="sum" visible="true"&gt;
    &lt;/Measure&gt;
    &lt;Measure name="&amp;#24050;&amp;#26680;&amp;#38144;&amp;#37329;&amp;#39069;" column="verification_amount" datatype="Numeric" formatString="#,###" aggregator="sum" visible="true"&gt;
    &lt;/Measure&gt;
    &lt;Measure name="&amp;#26410;&amp;#26680;&amp;#38144;&amp;#37329;&amp;#39069;" column="un_verification_amount" datatype="Numeric" formatString="#,###" aggregator="sum" visible="true"&gt;
    &lt;/Measure&gt;
  &lt;/Cube&gt;
  &lt;Role name="ROLE_ADMIN"&gt;
    &lt;SchemaGrant access="all"&gt;
      &lt;CubeGrant cube="userInfo" access="all"&gt;
      &lt;/CubeGrant&gt;
      &lt;CubeGrant cube="&amp;#37319;&amp;#38144;&amp;#36130;&amp;#21153;&amp;#22823;&amp;#34920;" access="all"&gt;
      &lt;/CubeGrant&gt;
    &lt;/SchemaGrant&gt;
  &lt;/Role&gt;
  &lt;Role name="ROLE_USER"&gt;
    &lt;SchemaGrant access="none"&gt;
      &lt;CubeGrant cube="userInfo" access="none"&gt;
      &lt;/CubeGrant&gt;
      &lt;CubeGrant cube="&amp;#37319;&amp;#38144;&amp;#36130;&amp;#21153;&amp;#22823;&amp;#34920;" access="all"&gt;
      &lt;/CubeGrant&gt;
    &lt;/SchemaGrant&gt;
  &lt;/Role&gt;
&lt;/Schema&gt;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Saiku介绍</h2>
<div class="outline-text-2" id="text-4">
<p>
Saiku是一个模块化的开源分析套件，它提供轻量级的OLAP（联机分析处理），并且可嵌入、可扩展、可配置。
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Saiku 基本配置</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">Schema 文件</h3>
<div class="outline-text-3" id="text-5-1">
<p>
saiku/saiku-core/saiku-web-ui/src/main/resources/schema/sone.mondrian.xml
</p>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2">连接数据库</h3>
<div class="outline-text-3" id="text-5-2">
<pre class="example">
type=OLAP
name=saiku_sone
driver=mondrian.olap4j.MondrianOlap4jDriver
location=jdbc:mondrian:Jdbc=jdbc:mysql://192.168.229.76:3306/sone?characterEncoding=UTF-8;Catalog=res:schema/sone.mondrian.xml;JdbcDrivers=com.mysql.jdbc.Driver;DynamicSchemaProcessor=mondrian.i18n.LocalizingDynamicSchemaProcessor;Locale=zh_CN;
username=root
password=123456
security.enabled=true
security.type=one2one
</pre>
</div>
</div>
<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3">自定义角色</h3>
<div class="outline-text-3" id="text-5-3">
<p>
SaikuMondrianHelper.java  setRoles
</p>
<div class="org-src-container">

<pre class="src src-java">public static class PeopleRole extends DelegatingRole {
    private final String repName;

    public PeopleRole(Role role, Schema schema, String repName) {
        super(((RoleImpl)role).makeMutableClone());
        this.repName = repName;
        defineGrantsForUser(schema);
        defineGrantsForCategory(schema);
    }

    private void defineGrantsForUser(Schema schema) {
        RoleImpl role = (RoleImpl)this.role;
        role.grant(schema, Access.NONE);

        Cube cube = schema.lookupCube("采销财务大表", true);
        role.grant(cube, Access.ALL);

        Hierarchy hierarchy = cube.lookupHierarchy(
            new Id.NameSegment("部门"), false);

        mondrian.olap.Level[] levels = hierarchy.getLevels();
        mondrian.olap.Level topLevel = levels[6];

        role.grant(hierarchy, Access.CUSTOM, null, null, RollupPolicy.FULL);
        role.grant(hierarchy.getAllMember(), Access.NONE);

        boolean foundMember = false;

        List &lt;Member&gt; members =
            schema.getSchemaReader().withLocus()
                .getLevelMembers(topLevel, true);

        for (Member member : members) {
            //   System.out.println("memeber unique name"+member.getUniqueName());
            if (member.getUniqueName().contains("[" + repName + "]")) {
                foundMember = true;
                role.grant(member, Access.ALL);
            }
        }
    }

private void defineGrantsForCategory(Schema schema) {
        RoleImpl role = (RoleImpl)this.role;
        role.grant(schema, Access.NONE);

        Cube cube = schema.lookupCube("采销财务大表", true);
        role.grant(cube, Access.ALL);

        Hierarchy hierarchy = cube.lookupHierarchy(
            new Id.NameSegment("分类"), false);

        mondrian.olap.Level[] levels = hierarchy.getLevels();
        mondrian.olap.Level topLevel = levels[6];

        role.grant(hierarchy, Access.CUSTOM, null, null, RollupPolicy.FULL);
        role.grant(hierarchy.getAllMember(), Access.NONE);

        boolean foundMember = false;

        List &lt;Member&gt; members =
            schema.getSchemaReader().withLocus()
                .getLevelMembers(topLevel, true);

        for (Member member : members) {
            //   System.out.println("memeber unique name"+member.getUniqueName());
            if (member.getUniqueName().contains("[" + 3396 + "]")) {
                foundMember = true;
                role.grant(member, Access.ALL);
            }
        }
    }
}
</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">saiku 插件编写</h2>
<div class="outline-text-2" id="text-6">
<ol class="org-ol">
<li><a href="https://github.com/OSBI/saiku-ui/wiki/Plugins">https://github.com/OSBI/saiku-ui/wiki/Plugins</a>
</li>
</ol>
</div>



<div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1">SaikuChartPlus  <a href="https://github.com/it4biz/SaikuChartPlus">https://github.com/it4biz/SaikuChartPlus</a></h3>
<div class="outline-text-3" id="text-6-1">
<p>
How to install
</p>

<p>
For Pentaho BA Users, please use Pentaho Marketplace
</p>

<p>
For Saiku Server Users, please follow the tutorial at section "Advanced instalation"
</p>

<p>
Advanced instalation
</p>
<ol class="org-ol">
<li>Edit the file saiku-server/tomcat/webapps/ROOT/index.html, insert the code below:
</li>
</ol>

<p>
&lt;!--search for this and put the files under this--&gt;
&lt;script type="text/javascript" src="js/saiku/plugins/CCC_Chart/plugin.js" &gt;&lt;/script&gt;
&lt;!--start js SaikuChartPlus--&gt;
&lt;script type="text/javascript" src="js/saiku/plugins/saiku-chart-plus/plugin.js" &gt;&lt;/script&gt;
&lt;!--end js SaikuChartPlus--&gt;
</p>
<ol class="org-ol">
<li>Download the project and extract the content of folder saiku-server on saiku-server/tomcat/webapps/ROOT/js/saiku/plugins/
</li>
</ol>

<p>
That's it!
</p>
</div>
</div>
</div>



<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">Saiku用户手册</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1">选择报表</h3>
<div class="outline-text-3" id="text-7-1">
<p>
在左上角的下拉列表中选择需要查看的报表。
</p>


<div class="figure">
<p><img src="/assets/blog/2014/06/16/saiku/saiku1.png" alt="/assets/blog/2014/06/16/saiku/saiku1.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2">添加维度</h3>
<div class="outline-text-3" id="text-7-2">
<p>
在选择所要查看的报表后，页面会列出报表的维度和指标的选项。
</p>


<div class="figure">
<p><img src="/assets/blog/2014/06/16/saiku/saiku2.png" alt="/assets/blog/2014/06/16/saiku/saiku2.png" />
</p>
</div>

<p>
拖动相应的维度和指标到页面右侧的“列”，”行“或者“过滤”。指标必须放在一起，但是维度可以放在上面三处的任意一处。
</p>


<div class="figure">
<p><img src="/assets/blog/2014/06/16/saiku/saiku3.png" alt="/assets/blog/2014/06/16/saiku/saiku3.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-sec-7-3" class="outline-3">
<h3 id="sec-7-3">执行查询</h3>
<div class="outline-text-3" id="text-7-3">
<p>
默认情况下，当维度和指标被放置到列和行以后，系统会自动执行查询，然后在下方显示报表内容。你也可以点击下面图片中的第二个按钮关闭自动查询。通
过下面图片中的第一个按钮手动执行。
</p>


<div class="figure">
<p><img src="/assets/blog/2014/06/16/saiku/saiku4.png" alt="/assets/blog/2014/06/16/saiku/saiku4.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-sec-7-4" class="outline-3">
<h3 id="sec-7-4">交换数轴</h3>
<div class="outline-text-3" id="text-7-4">
<p>
下图中的按钮是用于列和行之间的切换。
</p>


<div class="figure">
<p><img src="/assets/blog/2014/06/16/saiku/saiku5.png" alt="/assets/blog/2014/06/16/saiku/saiku5.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-sec-7-5" class="outline-3">
<h3 id="sec-7-5">排序</h3>
<div class="outline-text-3" id="text-7-5">
<p>
点击箭头可以对结果进行排序。
<img src="/assets/blog/2014/06/16/saiku/sort.png" alt="/assets/blog/2014/06/16/saiku/sort.png" />
</p>

<p>
下图显示了一个按照“已结算金额”进行降序排列的例子：
</p>


<div class="figure">
<p><img src="/assets/blog/2014/06/16/saiku/saiku6.png" alt="/assets/blog/2014/06/16/saiku/saiku6.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-sec-7-6" class="outline-3">
<h3 id="sec-7-6">筛选</h3>
<div class="outline-text-3" id="text-7-6">
<p>
查询按钮可以对查询结果进行筛选。
<img src="/assets/blog/2014/06/16/saiku/magnify.png" alt="/assets/blog/2014/06/16/saiku/magnify.png" />
</p>

<p>
点击查询按钮后会弹出一个对话框。对话框里列出所有的可选项，用户可以选择需要显示的内容。
</p>


<div class="figure">
<p><img src="/assets/blog/2014/06/16/saiku/saiku7.png" alt="/assets/blog/2014/06/16/saiku/saiku7.png" />
</p>
</div>
</div>
</div>


<div id="outline-container-sec-7-7" class="outline-3">
<h3 id="sec-7-7">保存报表</h3>
<div class="outline-text-3" id="text-7-7">
<p>
点击保存按钮可以把当前的查询保存下来。可以供自己或者他人使用。
</p>


<div class="figure">
<p><img src="/assets/blog/2014/06/16/saiku/saiku8.png" alt="/assets/blog/2014/06/16/saiku/saiku8.png" />
</p>
</div>

<p>
在弹出的保存对话框中，输入文件名称，点击保存。
</p>


<div class="figure">
<p><img src="/assets/blog/2014/06/16/saiku/saiku9.png" alt="/assets/blog/2014/06/16/saiku/saiku9.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-sec-7-8" class="outline-3">
<h3 id="sec-7-8">打开已保存的报表</h3>
<div class="outline-text-3" id="text-7-8">
<p>
点击打开按钮可以打开保存过的报表查询。
</p>


<div class="figure">
<p><img src="/assets/blog/2014/06/16/saiku/saiku10.png" alt="/assets/blog/2014/06/16/saiku/saiku10.png" />
</p>
</div>

<p>
在弹出框内选择保存的报表查询，点击打开。
</p>


<div class="figure">
<p><img src="/assets/blog/2014/06/16/saiku/saiku11.png" alt="/assets/blog/2014/06/16/saiku/saiku11.png" />
</p>
</div>


<div class="figure">
<p><img src="/assets/blog/2014/06/16/saiku/saiku12.png" alt="/assets/blog/2014/06/16/saiku/saiku12.png" />
</p>
</div>
</div>
</div>


<div id="outline-container-sec-7-9" class="outline-3">
<h3 id="sec-7-9">生成图表</h3>
<div class="outline-text-3" id="text-7-9">
<p>
点击右侧的“图表模式”按钮，为显示当前查询的各种图表格式。
</p>


<div class="figure">
<p><img src="/assets/blog/2014/06/16/saiku/saiku14.png" alt="/assets/blog/2014/06/16/saiku/saiku14.png" />
</p>
</div>


<div class="figure">
<p><img src="/assets/blog/2014/06/16/saiku/saiku13.png" alt="/assets/blog/2014/06/16/saiku/saiku13.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8">参考资料</h2>
<div class="outline-text-2" id="text-8">
<ul class="org-ul">
<li><a href="http://blog.csdn.net/leamonjxl/article/details/6681112">数据仓库的架构主要有星型和雪花型两种方式</a>
</li>
<li><a href="http://wenku.baidu.com/view/7a2615a20029bd64783e2cf1.html">http://wenku.baidu.com/view/7a2615a20029bd64783e2cf1.html</a>
</li>
<li><a href="http://blog.sina.com.cn/s/blog_7d8f0a900100qplj.html">http://blog.sina.com.cn/s/blog_7d8f0a900100qplj.html</a>
</li>
<li><a href="http://www.huqiwen.com/2012/06/15/olap-abstruct-and-mondrian-quick-start/">http://www.huqiwen.com/2012/06/15/olap-abstruct-and-mondrian-quick-start/</a>
</li>
<li><a href="http://customme.iteye.com/blog/1880478">Saiku Server环境搭建</a>
</li>
<li><a href="http://blog.csdn.net/longshenlmj/article/details/19111227">Saiku去掉登录模块</a>
</li>
<li><a href="https://github.com/pentaho/mondrian">https://github.com/pentaho/mondrian</a>
</li>
<li><a href="https://github.com/OSBI/saiku">https://github.com/OSBI/saiku</a>
</li>
<li><a href="http://ci.analytical-labs.com/">http://ci.analytical-labs.com/</a>
</li>
<li><a href="http://docs.analytical-labs.com/">http://docs.analytical-labs.com/</a>
</li>
<li>How to quickly add a date dimension to a Pentaho Mondrian OLAP cube <a href="http://www.freeportmetrics.com/devblog/2012/11/02/how-to-quickly-add-date-dimension-to-pentaho-mondrian-olap-cube/">http://www.freeportmetrics.com/devblog/2012/11/02/how-to-quickly-add-date-dimension-to-pentaho-mondrian-olap-cube/</a>
</li>
<li>Mondrian 文档 <a href="http://mondrian.pentaho.com/documentation/schema.php#Time_dimensions">http://mondrian.pentaho.com/documentation/schema.php#Time_dimensions</a>
</li>
</ul>
</div>
</div>

</div>
</div>
    <div>
      <div class="post-meta">
        <span title="post date" class="post-info">2014-06-16</span>
        <span title="last modification date" class="post-info">2014-07-28</span>
        <span title="tags" class="post-info"><a href="/tags/saiku/">saiku</a></span>
        <span title="author" class="post-info">Will</span>
      </div>
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          //var disqus_developer = 1;
          var disqus_identifier = "./blog/2014/06/16/saiku";
          var disqus_url = "http://standino.github.io./blog/2014/06/16/saiku";
          var disqus_shortname = 'standino';
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </section>
      <script src="http://code.jquery.com/jquery-latest.min.js"></script>
      <script src="https://google-code-prettify.googlecode.com/svn/loader/prettify.js"></script>
      <script src="/media/js/main.js"></script>
      <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-46515756-1']);
        _gaq.push(['_trackPageview']);
        (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.x (<a href="http://orgmode.org">Org mode</a> 8.x)</p>
        <p>
          Copyright &copy; 2012 - 2014 <a href="mailto:will &lt;at&gt; will-K42JA">Will</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/kelvinh/org-page" target="_blank">org-page</a>
        </p>
      </div>
    </div>
  </body>
</html>
