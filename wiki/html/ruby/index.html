<!DOCTYPE html>
<html lang="en-us">
<head>
  <title>ruby.org - Keep going</title>
  <meta charset="utf-8" />
  <meta name="author" content="Will Chang" />
    <meta name="description" content="Learning ruby " />
    <meta name="keywords" content="ruby" />

  <link rel="stylesheet" href="http://standino.github.io/media/css/main.css" type="text/css">
  <link rel="stylesheet" href="http://standino.github.io/media/css/prettify.css" type="text/css">

  <link rel="stylesheet" href="/media/css/prettify.css" type="text/css">
  <link rel="stylesheet" href="/media/css/main.css" type="text/css">

  <link rel="stylesheet" href="../../../media/css/main.css" type="text/css">
  <link rel="stylesheet" href="../../../media/css/prettify.css" type="text/css">

</head>
  <body class="container">
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="/">Keep going</a></h1>
        <p>努力超越自己！</p>
        <ul>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/html/">Html</a></li>
          <li><a href="/media/">Media</a></li>
          <li><a href="/tags/">Tags</a></li>
          <li><a href="/wiki/">Wiki</a></li>
          <li><a href="/tags/">Tags</a></li>
          <li><a href="/about/">About</a></li>
          <li><a href="https://github.com/standino">GitHub</a></li>
          <li><a href="/rss.xml">RSS</a></li>
        </ul>
        <form method="get" id="searchform" action="http://www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="q" value="site:standino.github.io">
        </form>
      </header>
    </div>

<div>
<div class="post">
<h1>ruby.org</h1>


<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">数学计算</h2>
<div class="outline-text-2" id="text-1">
<ol class="org-ol">
<li><a href="http://www.kuqin.com/rubycndocument/man/built-in-class/module_math.html">Ruby参考</a>
</li>
</ol>

<p>
在计算三角函数sina，cos，或者各种指数，平方根时，必须在程序前面加上include Math这一句话。sin值可以用sina方法求的，平方根可以用sprt
方法求的。
</p>

<p>
下面，让我们尝试计算3的平方： 
</p>

<p>
3**2
</p>

<p>
在Ruby语言中，**表示幂运算。那么如何计算平方根呢？ 
</p>




<p>
&lt;#+BEGIN_SRC &gt;
</p>

<p>
include Math
print("sin(3.14)=",sin(3.14),"\n")
print("cos(3.14)=",cos(3.14),"\n")
print("sqrt(10000)=",sqrt(10000),"\n")
#+END_SRC
</p>

<p>
----
</p>
<ul class="org-ul">
<li><a href="http://express.engineyard.com/">Could computing with ruby and erlang</a>
</li>
<li><a href="http://antoniocangiano.com/2008/02/08/essential-guide-to-the-ruby-driver-for-db2/"> Ruby and DB2</a>
</li>
<li><a href="http://antoniocangiano.com/rubypython-and-db2-drivers/">Guide to setting up the IBM Ruby and Python drivers for DB2 on Linux (32 or 64 bit)</a>
</li>
<li></li>
<li><a href="http://olabini.com/blog/2008/09/language-generation/">AI in ruby</a> 
</li>
<li>ruby的gems有 <i>www.ruby-toolbox.com</i> 
</li>
<li>rails的plugins有 <i>agilewebdevelopment.com/plugins</i>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">ruby differ</h2>
<div class="outline-text-2" id="text-2">
<p>
<a href="http://github.com/pvande/differ">http://github.com/pvande/differ</a>
</p>

<pre class="example">
will@will-laptop:~/Desktop/diff$ irb -rubygems
irb(main):001:0&gt; irb -rubygems
NameError: undefined local variable or method `rubygems' for main:Object
	from (irb):1
irb(main):002:0&gt; require 'differ'
=&gt; true
irb(main):003:0&gt; @original = "Epic lolcat fail!"
=&gt; "Epic lolcat fail!"
irb(main):004:0&gt;   @current  = "Epic wolfman fail!"
=&gt; "Epic wolfman fail!"
irb(main):005:0&gt; @diff = Differ.diff_by_line(@current, @original)
=&gt; #&lt;Differ::Diff:0xb75103a8 @raw=[{"Epic lolcat fail!" &gt;&gt; "Epic wolfman fail!"}]&gt;
irb(main):006:0&gt; require 'differ/string'
=&gt; true
irb(main):007:0&gt; @diff = (@current - @original)
=&gt; #&lt;Differ::Diff:0xb750a110 @raw=[{"Epic lolcat fail!" &gt;&gt; "Epic wolfman fail!"}]&gt;
irb(main):008:0&gt;   @diff.format_as(:color)
=&gt; "\e[31mEpic lolcat fail!\e[0m\e[32mEpic wolfman fail!\e[0m"
irb(main):009:0&gt;   @diff.format_as(:html)
=&gt; "&lt;del class=\"differ\"&gt;Epic lolcat fail!&lt;/del&gt;&lt;ins class=\"differ\"&gt;Epic wolfman fail!&lt;/ins&gt;"
irb(main):010:0&gt; $; = ' '
=&gt; " "
irb(main):011:0&gt; @diff = (@current - @original)
=&gt; #&lt;Differ::Diff:0xb74fdc44 @raw=["Epic ", {"lolcat" &gt;&gt; "wolfman"}, " fail!"]&gt;
irb(main):012:0&gt;   @diff.format_as(:html)
=&gt; "Epic &lt;del class=\"differ\"&gt;lolcat&lt;/del&gt;&lt;ins class=\"differ\"&gt;wolfman&lt;/ins&gt; fail!"
irb(main):013:0&gt; $; = ';'
=&gt; ";"
irb(main):014:0&gt; @diff = (@current - @original)
=&gt; #&lt;Differ::Diff:0xb74f3014 @raw=[{"Epic lolcat fail!" &gt;&gt; "Epic wolfman fail!"}]&gt;
irb(main):015:0&gt;
</pre>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Execute cmd and get the output</h2>
<div class="outline-text-2" id="text-3">
<p>
IO.popen("help") {|d| d.readlines.each {|x|puts x} } 
</p>
</div>
</div>



<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Ruy gem</h2>
<div class="outline-text-2" id="text-4">
<p>
<a href="http://rubygems.org/read/chapter/5">http://rubygems.org/read/chapter/5</a>
<a href="http://www.hhtong.com/blog1/articles/2007/06/10/ruby-gpgen-20070603">http://www.hhtong.com/blog1/articles/2007/06/10/ruby-gpgen-20070603</a>
</p>

<pre class="example">
gem install gem_plugin 
gpgen easywebtest
</pre>

<p>
RubyGems是一个库和程序的标准化打包以及安装框架，它使定位、安装、升级和卸载Ruby包变的很容易。rails以及它的大部分插件都是以gem形式发布的。本文描述一个自己创建ruby Gems的过程。
    假设你今天用ruby实现了一个stack结构，你想发布到网上让别人可以共享，OK，工作开始了。首先你的程序当然要先写好了：
Ruby代码
</p>

<ol class="org-ol">
<li>#stacklike.rb  
</li>
<li>module Stacklike  
</li>
<li>attr_reader:stack  
</li>
<li>def initialize  
</li>
<li>@stack=Array.new  
</li>
<li>end  
</li>
<li>def add_to_stack(obj)  
</li>
<li>@stack.push(obj)  
</li>
<li>end   
</li>
<li>def take_from_stack  
</li>
<li>@stack.pop  
</li>
<li>end  
</li>
<li>def size  
</li>
<li>@stack.length  
</li>
<li>end  
</li>
<li>alias length size  
</li>
<li></li>
<li>def clear  
</li>
<li>@stack.clear  
</li>
<li>end  
</li>
<li>end        
</li>
</ol>

<p>
#stacklike.rb
module Stacklike
 attr_reader:stack
 def initialize
    @stack=Array.new
 end
 def add_to_stack(obj)
    @stack.push(obj)
 end 
 def take_from_stack
    @stack.pop
 end
 def size
    @stack.length
 end
 alias length size
</p>

<p>
 def clear
   @stack.clear
 end
end      
</p>


<p>
然后就是我们的Stack类，引入这个Module，请注意，我们这里只是特意这样做，增加点复杂度：
Ruby代码
</p>

<ol class="org-ol">
<li>#stack.rb  
</li>
<li>require 'stacklike'  
</li>
<li>class Stack  
</li>
<li>include Stacklike  
</li>
<li>end  
</li>
</ol>

<p>
#stack.rb
require 'stacklike'
class Stack
 include Stacklike
end
</p>


<p>
作为一个要被"大众"使用的小程序，一定要有完备的测试代码，OK,ruby内置了单元测试库，我们来写个单元测试来测试Stack：
Ruby代码
</p>

<ol class="org-ol">
<li>require 'stack'  
</li>
<li>require 'test/unit'  
</li>
<li>class TestStack &lt;Test::Unit::TestCase  
</li>
<li>def testStack  
</li>
<li>stack=Stack.new  
</li>
<li>assert_equal(0,stack.size)  
</li>
<li>assert_equal(stack.length,stack.size)   
</li>
<li>stack.add_to_stack(1)  
</li>
<li>assert_equal(1,stack.length)  
</li>
<li>assert_equal(1,stack.take_from_stack)  
</li>
<li></li>
<li>stack.clear  
</li>
<li>assert_equal(0,stack.length)  
</li>
<li>assert_nil(stack.take_from_stack)  
</li>
<li></li>
<li>10.times{|i| stack.add_to_stack(i)}  
</li>
<li>assert_equal(10,stack.size)  
</li>
<li>assert_equal(stack.length,stack.size)  
</li>
<li>9.downto(4){|i| assert_equal(i,stack.take_from_stack)}   
</li>
<li></li>
<li>assert_equal(4,stack.length)  
</li>
<li>assert_equal(3,stack.take_from_stack)  
</li>
<li>assert_equal(3,stack.length)  
</li>
<li></li>
<li>stack.clear  
</li>
<li>assert_equal(0,stack.length)  
</li>
<li>assert_nil(stack.take_from_stack)  
</li>
<li>end  
</li>
<li>end  
</li>
</ol>

<p>
require 'stack'
require 'test/unit'
class TestStack &lt;Test::Unit::TestCase
  def testStack
    stack=Stack.new
    assert_equal(0,stack.size)
    assert_equal(stack.length,stack.size) 
    stack.add_to_stack(1)
    assert_equal(1,stack.length)
    assert_equal(1,stack.take_from_stack)
</p>

<p>
stack.clear
assert_equal(0,stack.length)
assert_nil(stack.take_from_stack)
</p>

<p>
10.times{|i| stack.add_to_stack(i)}
assert_equal(10,stack.size)
assert_equal(stack.length,stack.size)
9.downto(4){|i| assert_equal(i,stack.take_from_stack)} 
</p>

<p>
assert_equal(4,stack.length)
assert_equal(3,stack.take_from_stack)
assert_equal(3,stack.length)
</p>

<p>
    stack.clear
    assert_equal(0,stack.length)
    assert_nil(stack.take_from_stack)
  end
end
</p>


<p>
如果你使用radrails或者RDT运行这段代码，你将看到让人舒服的greenbar，一切正常。程序写好了，接下来就是关键步骤了，怎么发布成ruby Gems呢？
</p>

<p>
第一步，写Gems规范文件
   gemspec是ruby或者YAML形式的元数据集，用来提供这个gem的关键信息，我们创建一个文件夹就叫stack，然后在下面建立2个目录两个文件：
lib目录：用于存放库的源代码，比如这个例子中的stack.rb,stacklike.rb
test目录：用于存放单元测试代码。
README文件：描述你的库的基本信息和版权许可证等
stack.gemspec：gems规范文件，用以生成gem
当然，也可以有docs目录用以存放rdoc文档和ext目录用以存放ruby扩展，我们这个简单例子就免了。
看看我们的规范文件：
Ruby代码
</p>

<ol class="org-ol">
<li>#stack.spec  
</li>
<li>require 'rubygems'  
</li>
<li>SPEC=Gem::Specification.new do |s|  
</li>
<li>s.name="Stack"  
</li>
<li>s.version='0.01'  
</li>
<li>s.author='dennis zane'  
</li>
<li>s.email="killme2008@gmail.com"  
</li>
<li>s.homepage="<a href="http://www.rubyeye.net">http://www.rubyeye.net</a>"  
</li>
<li>s.platform=Gem::Platform::RUBY  
</li>
<li>s.summary="ruby实现的Stack"  
</li>
<li>condidates =Dir.glob("{bin,lib,docs,test}/**/*")  
</li>
<li>s.files=condidates.delete_if do |item|  
</li>
<li>item.include?("CVS")|| item.include?("rdoc")  
</li>
<li>end  
</li>
<li>s.require_path="lib"  
</li>
<li>s.autorequire='stack,stacklike'  
</li>
<li>s.test_file="test/ts_stack.rb"  
</li>
<li>s.has_rdoc=false  
</li>
<li>s.extra_rdoc_files=["README"]  
</li>
<li>end    
</li>
</ol>

<pre class="example">
#stack.spec
require 'rubygems'
SPEC=Gem::Specification.new do |s|
  s.name="Stack"
  s.version='0.01'
  s.author='dennis zane'
  s.email="killme2008@gmail.com"
  s.homepage="http://www.rubyeye.net"
  s.platform=Gem::Platform::RUBY
  s.summary="ruby实现的Stack"
  condidates =Dir.glob("{bin,lib,docs,test}/**/*")
  s.files=condidates.delete_if do |item|
    item.include?("CVS")|| item.include?("rdoc")
  end
  s.require_path="lib"
  s.autorequire='stack,stacklike'
  s.test_file="test/ts_stack.rb"
  s.has_rdoc=false
  s.extra_rdoc_files=["README"]
end
</pre>

<p>
很明显，规范文件也是ruby程序（也可以用YAML描述），设置了这个gem的主要关键信息：名称、作者信息、平台,需要注意的就是files 数组过滤掉了cvs和rdoc文件，require_path和auto_require让你指定了require_gem装入gem时会被添加到$ LOAS_PATH（ruby查找库的路径）中的目录（也就是我们源代码存放的lib），auto_require指定了装载的文件名，我们没有 rdoc，所有设置has_rdoc为false，附带文档就是README。
</p>

<p>
第二步 修改单元测试文件引用路径
过去我们假设ts_stack.rb与stack.rb、stacklike.rb在同一个目录下，可是我们现在将它们分别放在lib和test目录，TestStack 怎么引用测试的类呢？答案是在ts_stack.rb开头加上一行：
Ruby代码
</p>

<ol class="org-ol">
<li>$:.unshift File.join(File.dirname(<span class="underline"><span class="underline">FILE</span></span>),"..","lib")  
</li>
</ol>

<p>
$:.unshift File.join(File.dirname(<span class="underline"><span class="underline">FILE</span></span>),"..","lib")
</p>


<p>
最后一步 构建gem
在stack目录执行下列命令：
Ruby代码
</p>

<ol class="org-ol">
<li>ruby stack.gemspec  
</li>
</ol>

<p>
ruby stack.gemspec
</p>


<p>
或者:
Ruby代码
</p>

<ol class="org-ol">
<li>gem build stack.gemspec  
</li>
</ol>

<p>
gem build stack.gemspec
</p>


<p>
将生成一个文件，你可以将这个文件共享给朋友们咯。你的朋友只要下载这个文件，执行：
Ruby代码
</p>

<ol class="org-ol">
<li>gem install Stack.0.01.gem  
</li>
</ol>

<p>
gem install Stack.0.01.gem
</p>


<p>
将在他们的ruby环境中安装你写的stack，比较遗憾的是，你这个stack确实太简陋了，哈哈。 
</p>
</div>
</div>


<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">web server</h2>
<div class="outline-text-2" id="text-5">
<p>
<a href="http://snippets.dzone.com/tag/webrick">http://snippets.dzone.com/tag/webrick</a>
</p>


<ul class="org-ul">
<li>Ruby send mail with attathment
</li>
</ul>

<p>
 &lt;#+BEGIN_SRC &gt;
 gem install actionmailer
 gem install mime-types
#+END_SRC
</p>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Ruby dummy mail server</h2>
<div class="outline-text-2" id="text-6">
<p>
&lt;#+BEGIN_SRC &gt;
  gem sources -a <a href="http://gems.github.com">http://gems.github.com</a>
  gem install koseki-mocksmtpd
cd ~/.gem/ruby/1.8/bin
  ./mocksmtpd  init ~/testmail
  sudo ./mocksmtpd -f ~/testmail/mocksmtpd.conf 
#+END_SRC
</p>

<p>
send mail to test@changweilaptop.dyn.webahead.ibm.com
</p>

<p>
You will get the mail in  <a href="file:///home/will/testmail/inbox/index.html">file:///home/will/testmail/inbox/index.html</a>
</p>

<p>
But the mail body is not readable.
</p>
</div>
</div>


<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">Ruby to exe</h2>
<div class="outline-text-2" id="text-7">
<p>
<a href="http://rubyforge.org/projects/ocra">http://rubyforge.org/projects/ocra</a> 
</p>

<p>
<a href="http://github.com/larsch/ocra">http://github.com/larsch/ocra</a> 
</p>

<p>
（水果党和 linuser 先站一边去 ……） 
One-Click Ruby Application，就是把解释器、gem 什么的打包在一起做成独立 exe。 
  比 rubyscript2exe 和 exerb 先进，支持 1.9。 
</p>

<p>
安装： 
Console代码 
gem install ocra  
</p>

<p>
或者下载 stand alone not complex 的 .exe 
</p>

<p>
假设要把 testo.rb 做成 exe，只需： 
Console代码 
ocra.rb.bat testo.rb  
</p>


<p>
输出看起来像这样（它把用到的东西都打包到 exe 里面了）： 
<code>=</code> Loading script to check dependencies 
testo vooo 
<code>=</code> Building testo.exe 
m #+BEGIN_SRC  
a #+BEGIN_SRC  
m bin 
a bin\ruby.exe 
a bin\msvcr100-ruby191.dll 
a bin\MSVCR100.dll 
m lib 
m lib\ruby 
m lib\ruby\1.9.1 
m lib\ruby\1.9.1\i386-mswin32_100 
m lib\ruby\1.9.1\i386-mswin32_100\enc 
a lib\ruby\1.9.1\i386-mswin32_100\enc\encdb.so 
a lib\ruby\1.9.1\i386-mswin32_100\enc\euc_kr.so 
a lib\ruby\1.9.1\i386-mswin32_100\enc\gb2312.so 
m lib\ruby\1.9.1\i386-mswin32_100\enc\trans 
a lib\ruby\1.9.1\i386-mswin32_100\enc\trans\transdb.so 
a lib\ruby\1.9.1\i386-mswin32_100\enc\gbk.so 
a lib\ruby\1.9.1\rubygems.rb 
e RUBYOPT rubygems 
e RUBYLIB 
l bin\ruby.exe ruby.exe  \#+BEGIN_SRC  
<code>=</code> Compressing 
<code>=</code> Finished (Final size was 781622) - 只有 781k 的 standalone 
</p>

<p>
一些琐碎的东西： 
</p>


<p>
 ocra 之前，路径变量中应该包含 ruby_home\bin，ocra 是根据 path 中找到的第一个 ruby 解释器来决定库文件位置的。设定路径变量例：
Console代码 
set path=d:\Ruby\ruby1.9.1\bin;%path%  
</p>



<p>
需要 win32-api gem，如果你的 ruby 不是官方 1.8.x 二进制，安装 win32-api gem 前记得先把编译器环境设好。
</p>


<p>
 一般 ocra 一个文件就行了（例如你要打包一个 rails app 的话，就去 ocra.rb.bat script\server）
有些依赖关系不能通过 require 或者 load 体现，得手动添加。例子：（添加图片和一个目录） 
Cosole代码 
ocra.rb.bat mainscript.rb someimage.jpeg docs/  
</p>



<p>
 对于 GUI 程序，在 main loop 之前加个判断，避免在打包过程中启动程序弹出窗口：
Ruby代码 
unless defined? Ocra  
  app.main_loop  
end  
</p>



<p>
 注意工作目录，最简易的手段是加上
Ruby代码 
Dir.chdir File.dirname <span class="underline"><span class="underline">FILE</span></span>  
</p>



<p>
某些情况可能需要 mingw 编译 stub，所以到 <a href="http://rubyinstaller.org/downloads/">http://rubyinstaller.org/downloads/</a> 下载一个 devkit 可以有备无患。
</p>


<p>
可用选项： 
Options代码 
--dll dllname    将额外的 dll 包含进 bin 目录  
--no-lzma        取消可执行文件的 LZMA 压缩（体积大一点，运行是否快一点就看你硬盘不是/是 SSD 了）  
--quiet          格林..达姆自己  
--help           显示帮助  
--windows        产生窗口程序（rubyw.exe）  
--console        产生控制台程序（ruby.exe）  
--no-autoload    不预先加载/包含脚本文件的 autoloads（感觉对速度没什么影响）  
--icon &lt;ico&gt;     自定图标  
--version        显示版本号  
</p>
</div>
</div>


<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8">Ruby trick</h2>
<div class="outline-text-2" id="text-8">
<p>
<a href="http://www.javaeye.com/topic/414412">http://www.javaeye.com/topic/414412</a>
</p>

<p>
&lt;#+BEGIN_SRC &gt;
match, text, number = * "Something 981".match(<i>([A-z]*) ([0-9]*)</i>)  
#+END_SRC
</p>

<p>
hash作参数： 
</p>

<p>
Ruby代码 
&lt;#+BEGIN_SRC &gt;
def m option={}  
  arg2 = option[:arg2]  
  arg1 = option[:arg1]  
  print arg2,arg1  
end  
</p>

<p>
m :arg2 =&gt;"Hi", :arg1 = &gt; "hooopo"  
 #Hihooopo  
</p>

<p>
#+END_SRC
</p>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9">JRuby</h2>
<div class="outline-text-2" id="text-9">
<p>
jruby -S gem install antwrap 
</p>


<p>
<a href="http://wiki.jruby.org/wiki/html/Running_Rails_with_ActiveRecord-JDBC">Jruby on rails</a>
</p>
</div>
</div>


<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10">DB2</h2>
<div class="outline-text-2" id="text-10">
<p>
this version run gem install ibm_db on Windows. On Linux run the following:
&lt;#+BEGIN_SRC &gt;
$ . /home/db2inst1/db2profile
$ export IBM_DB_DIR=/opt/ibm/db2/V9.5
$ export IBM_DB_LIB=/opt/ibm/db2/V9.5/lib32
$ sudo gem install ibm_db
#+END_SRC
</p>
</div>
</div>
<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11">GUI</h2>
<div class="outline-text-2" id="text-11">
<p>
<a href="http://shoooes.net/">http://shoooes.net/</a>
</p>
</div>
</div>

<div id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12">mail</h2>
<div class="outline-text-2" id="text-12">
<p>
&lt;#+BEGIN_SRC &gt;
require 'rubygems' 
require 'action_mailer' 
require 'mime/types' 
</p>

<p>
ActionMailer::Base.smtp_settings = { :address  =&gt;   
'10.209.3.26', :domain =&gt; '3dlabs.com'} 
</p>

<p>
class Mailer &lt; ActionMailer::Base 
        def message (title, body) 
                from 'Dave Baldwin &lt;dave.baldwin@...&gt;' 
                recipients 'dave.baldwin@...' 
                subject        title 
                body body 
</p>

<p>
                FileList['PDF/*.pdf'].each do |path| 
                        file = File.basename(path) 
                        mime_type = MIME::Types.of(file).first 
                        content_type = mime_type ? mime_type.content_type : 'application/ 
binary' 
                        attachment (content_type) do |a| 
                                a.body = File.read(path) 
                                a.filename = file 
                                a.transfer_encoding = 'quoted-printable' if content_type =~ <i>^text 
\/</i> 
                        end 
                end 
        end 
end 
</p>

<p>
Mailer.deliver_message('some title', 'the body message') 
</p>

<p>
#+END_SRC
</p>
</div>
</div>


<div id="outline-container-sec-13" class="outline-2">
<h2 id="sec-13">passing parameter to ruby main</h2>
<div class="outline-text-2" id="text-13">
<pre class="example">
if ARGV.size != 1
  puts "Usage: gencr time  15:00 or \"3/4 15:00\""
  exit
end


copyfilesbefore ARGV[0]
</pre>
</div>
</div>

<div id="outline-container-sec-14" class="outline-2">
<h2 id="sec-14">Time</h2>
<div class="outline-text-2" id="text-14">
<pre class="example">
Time.local(2008, 3, 5, 11, 20, 00)
# Suppose it is "Thu Nov 29 14:33:20 GMT 2001" now and
# your timezone is GMT:
Time.parse("16:30")     #=&gt; Thu Nov 29 16:30:00 GMT 2001
Time.parse("7/23")      #=&gt; Mon Jul 23 00:00:00 GMT 2001
Time.parse("Aug 31")    #=&gt; Fri Aug 31 00:00:00 GMT 2001
</pre>
</div>
</div>

<div id="outline-container-sec-15" class="outline-2">
<h2 id="sec-15">audio file</h2>
<div class="outline-text-2" id="text-15">
<p>
<a href="http://ruby-audiofile.sourceforge.net/">http://ruby-audiofile.sourceforge.net/</a>
</p>

<p>
<a href="http://id3lib-ruby.rubyforge.org/">http://id3lib-ruby.rubyforge.org/</a>
</p>

<p>
<a href="http://mp3splt.sourceforge.net/mp3splt_page/home.php"><a href="http://mp3splt.sourceforge.net/mp3splt_page/home.php">http://mp3splt.sourceforge.net/mp3splt_page/home.php</a></a>
</p>
</div>
</div>

<div id="outline-container-sec-16" class="outline-2">
<h2 id="sec-16">Ruby web test framework</h2>
<div class="outline-text-2" id="text-16">
<ol class="org-ol">
<li><a href="http://watirwebdriver.com/">Watir WebDriver</a>
</li>
</ol>

<p>
sudo apt-get install curl git-core
</p>

<p>
bash -s stable &lt; &lt;(curl -s <a href="https://raw.github.com/wayneeseguin/rvm/master/binscripts/rvm-installer">https://raw.github.com/wayneeseguin/rvm/master/binscripts/rvm-installer</a> )
</p>

<p>
rvm pkg install openssl
</p>

<p>
rvm install 1.9.3-p125 --with-openssl-dir=$rvm_path/usr
</p>



<p>
HomePage <a href="http://wiki.openqa.org/dashboard.action">http://wiki.openqa.org/dashboard.action</a>
</p>

<p>
<a href="http://wtr.rubyforge.org/install.html">http://wtr.rubyforge.org/install.html</a>
</p>

<p>
<a href="http://code.google.com/p/tg4rb/">http://code.google.com/p/tg4rb/</a>
</p>

<p>
&lt;#+BEGIN_SRC &gt;
require 'rubygems'
require 'firewatir' 
#+END_SRC
</p>


<p>
You need install firefox plugin too.
</p>


<p>
Unit test sample code is in the /var/lib/gems/1.8/gems/firewatir-1.6.2/unittests
</p>

<p>
<a href="http://wiki.openqa.org/display/WTR/Tutorial">http://wiki.openqa.org/display/WTR/Tutorial</a>
</p>
</div>

<div id="outline-container-sec-16-1" class="outline-3">
<h3 id="sec-16-1"><a href="http://wiki.openqa.org/display/WTR/Cheat+Sheet">Cheat Sheet</a></h3>
<div class="outline-text-3" id="text-16-1">
</div><div id="outline-container-sec-16-1-1" class="outline-4">
<h4 id="sec-16-1-1">Getting Started</h4>
<div class="outline-text-4" id="text-16-1-1">
<p>
Load the Watir library
</p>

<pre class="example">
require 'watir'
</pre>

<p>
Open a browser (default: Internet Explorer)
</p>

<pre class="example">
browser = Watir::Browser.new
</pre>

<p>
Open Browser at the specified URL
</p>
<pre class="example">
browser = Watir::Browser.start("http://google.com")
</pre>

<p>
Go to a specified URL
</p>
<pre class="example">
browser.goto("http://amazon.com")
</pre>

<p>
Close the browser
</p>
<pre class="example">
browser.close
</pre>
</div>
</div>

<div id="outline-container-sec-16-1-2" class="outline-4">
<h4 id="sec-16-1-2">Browser options (IE only)</h4>
<div class="outline-text-4" id="text-16-1-2">
<p>
Speed up execution
(or use the "-b" command line switch)
</p>
<pre class="example">
browser.speed = :fast
</pre>

<p>
Maximize browser window
</p>
<pre class="example">
browser.maximize
</pre>

<p>
Pop browser window to front
</p>
<pre class="example">
browser.bring_to_front
</pre>
</div>
</div>

<div id="outline-container-sec-16-1-3" class="outline-4">
<h4 id="sec-16-1-3">Access an Element</h4>
<div class="outline-text-4" id="text-16-1-3">
<p>
Text box or text area
</p>
<pre class="example">
t = browser.text_field(:name, "username")
</pre>
<p>
Button
</p>
<pre class="example">
b = browser.button(:value, "Click Here")
</pre>
<p>
Drop down list
</p>
<pre class="example">
d = browser.select_list(:name, "month")
</pre>
<p>
Check box
</p>
<pre class="example">
c = browser.checkbox(:name, "enabled")
</pre>
<p>
Radio button
</p>
<pre class="example">
r = browser.radio(:name, "payment type")
</pre>
<p>
Form
</p>
<pre class="example">
f = browser.form(:name, "address")
f = browser.form(:action, "submit")
</pre>
<p>
Link
</p>
<pre class="example">
l = browser.link(:url, "http://google.com")
l = browser.link(:href, "http://google.com")
</pre>
<p>
Table cell in a table (2nd row, 1st column)
</p>
<pre class="example">
td = browser.table(:name, 'recent_records')[2][1]
</pre>
</div>
</div>

<div id="outline-container-sec-16-1-4" class="outline-4">
<h4 id="sec-16-1-4">Manipulate the Element</h4>
<div class="outline-text-4" id="text-16-1-4">
<p>
Click a button or link
</p>
<pre class="example">
b.click
l.click
</pre>
<p>
Enter text in a text box
</p>
<pre class="example">
t.set("mickey mouse")
</pre>
<p>
Enter multiple lines in a multi-line text box
</p>
<pre class="example">
t.set("line 1\nline2")
</pre>
<p>
Set radio button or check box
</p>
<pre class="example">
c.set
r.set
</pre>
<p>
Clear an element
</p>
<pre class="example">
t.clear
c.clear
r.clear
</pre>
<p>
Select an option in a drop down list
</p>
<pre class="example">
d.select "cash"
d.set "cash"
</pre>
<p>
Clear a drop down list
</p>
<pre class="example">
d.clearSelection
</pre>
<p>
Submit a form
</p>
<pre class="example">
f.submit
</pre>
<p>
Flash any element (useful from the watir-console)
</p>
<pre class="example">
e.flash
</pre>
</div>
</div>

<div id="outline-container-sec-16-1-5" class="outline-4">
<h4 id="sec-16-1-5">Check the Contents</h4>
<div class="outline-text-4" id="text-16-1-5">
<p>
Return the html of the page or any element
</p>
<pre class="example">
browser.html
e.html
</pre>
<p>
Return the text of the page or any element
</p>
<pre class="example">
browser.text
e.text
</pre>
<p>
Return the title of the document
</p>
<pre class="example">
browser.title
</pre>


<p>
Get text from status bar.
</p>
<pre class="example">
browser.status
=&gt; "Done"
</pre>
<p>
Return true if the specified text appears on the page
</p>
<pre class="example">
browser.text.include? 'llama'
</pre>
<p>
Return the contents of a table as an array
</p>
<pre class="example">
browser.table(:id, 'recent_records').to_a
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-16-2" class="outline-3">
<h3 id="sec-16-2">Firefox</h3>
<div class="outline-text-3" id="text-16-2">
<p>
<a href="http://wiki.openqa.org/display/WTR/FireWatir+Installation#FireWatirInstallation-InstalltheJSSHFirefoxExtension">http://wiki.openqa.org/display/WTR/FireWatir+Installation#FireWatirInstallation-InstalltheJSSHFirefoxExtension</a>
</p>
</div>
</div>

<div id="outline-container-sec-16-3" class="outline-3">
<h3 id="sec-16-3">FAQ</h3>
<div class="outline-text-3" id="text-16-3">
<p>
<a href="http://wiki.openqa.org/display/WTR/FAQ#FAQ-HowdoIgenerateXMLreportsfrommytestcaseresults?">http://wiki.openqa.org/display/WTR/FAQ#FAQ-HowdoIgenerateXMLreportsfrommytestcaseresults?</a>
</p>
</div>
</div>

<div id="outline-container-sec-16-4" class="outline-3">
<h3 id="sec-16-4">FireWatir</h3>
<div class="outline-text-3" id="text-16-4">
<p>
<a href="http://wiki.openqa.org/display/WTR/FireWatir">http://wiki.openqa.org/display/WTR/FireWatir</a>
</p>
</div>
</div>

<div id="outline-container-sec-16-5" class="outline-3">
<h3 id="sec-16-5">How do I deal with timing issues and not use sleep?</h3>
<div class="outline-text-3" id="text-16-5">
<p>
Sometimes you need to wait for something to happen in the Application under test before you interact with it. Sleep statements are hardcoded and lock you down into a certain number of seconds before moving through your test. To avoid that, we've written a polling mechanism in the latest versions of Watir - the wait_until method.
</p>

<p>
An example might be that you're loading the Google home page and for some reason it's taking time to load. Here's a basic contrived script with a sleep statement.
</p>

<p>
require 'watir'
</p>

<p>
browser = Watir::IE.start('http://www.google.com')
sleep 5     # we need to wait for the page to load and on a subjective basis I've chosen 5 seconds which works on my machine
browser.text_field(:name, 'q').set('ruby poignant')
....
</p>

<p>
Unfortunately the sleep is hardcoded and doesn't work for anyone else on my team who have slower network connections, my connection has gotten faster, but it still waits for 5 seconds before setting the text field.
</p>

<p>
Watir 1.5.x has added a wait_until method that can poll for a certain condition to return true before continuing on or erroring out. By default it checks the condition every half second up until 60 seconds. So I rewrite my code to look like this:
</p>

<p>
require 'watir'
</p>

<p>
browser = Watir::IE.start('http://www.google.com')
Watir::Waiter.wait_until{ browser.text_field(:name, 'q').exists? }    # in this case all I care about is the text field existing, you could check title, text, anything you're
</p>
<p>
browser.text_field(:name, 'q')set('ruby poignant')
...
</p>

<p>
It now works for me with a half second delay, but also works for the other members of my team who have network delays up to a
minute. If you're considering using sleep, use wait_until instead. It will make your test code more resilient to timing issues in
those cases where you really need to use it. 
</p>
</div>
</div>
</div>

<div id="outline-container-sec-17" class="outline-2">
<h2 id="sec-17">在Cygwin使用Ruby问题</h2>
<div class="outline-text-2" id="text-17">
<p>
Aug 08
</p>

<p>
Tech Cheery 1 Comment »
</p>

<p>
E-texteditor需要cygwin来使用Bundles的功能，在默认的安装的情况下在cygwin中调用ruby会出现
/usr/bin/ruby: no such file to load -- ubygems (LoadError)
的错误提示。n
</p>

<p>
这是因为cygwin中虽然声明了RUBYOPT环境变量，但是rubygem却并没有安装。
declare -x RUBYOPT="-rubygems"
</p>

<p>
一种解决方法是使用
unset RUBYOPT
清楚此变量，可以将其写入cygwin的用户profile中。
</p>

<p>
另一种彻底的解决方法是到rubyforge上下载<a href="http://rubyforge.org/frs/download.php/35283/rubygems-1.1.1.tgz">rubygem</a>然后在cygwin下安装，一劳永逸。
</p>

<p>
安装方法，解压下载的压缩包，在cygwin下进入其目录，先使用unset RUBYOPT，然后ruby setup.rb 即可完成安装。
</p>
</div>
</div>


<div id="outline-container-sec-18" class="outline-2">
<h2 id="sec-18">ruby 规范</h2>
<div class="outline-text-2" id="text-18">
<p>
<a href="http://www.javaeye.com/topic/370007">http://www.javaeye.com/topic/370007</a>
</p>
</div>
</div>


<div id="outline-container-sec-19" class="outline-2">
<h2 id="sec-19">Unit Test</h2>
<div class="outline-text-2" id="text-19">
<p>
&lt;#+BEGIN_SRC &gt;
</p>

<p>
If we want, we can ask it to run just a particular test method:
% ruby test_roman.rb -n test_range
Loaded suite test_roman
Started
.
Finished in 0.000600 seconds.
1 tests, 2 assertions, 0 failures, 0 errors, 0 skips
or tests whose names match a regular expression:
% ruby test_roman.rb -n <i>range</i>
Loaded suite test_roman
Started
.
Finished in 0.001036 seconds.
1 tests, 2 assertions, 0 failures, 0 errors, 0 skips
</p>

<p>
#+END_SRC
</p>
</div>
</div>

</div>
</div>
    <div>
      <div class="post-meta">
        <span title="post date" class="post-info">2013-12-19</span>
        <span title="last modification date" class="post-info">2014-08-20</span>
        <span title="tags" class="post-info"><a href="/tags/ruby/">ruby</a></span>
        <span title="author" class="post-info">Will Chang</span>
      </div>
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          //var disqus_developer = 1;
          var disqus_identifier = "/wiki/html/ruby";
          var disqus_url = "http://standino.github.io/wiki/html/ruby";
          var disqus_shortname = 'standino';
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </section>
      <script src="http://code.jquery.com/jquery-latest.min.js"></script>
      <script src="https://google-code-prettify.googlecode.com/svn/loader/prettify.js"></script>
      <script src="/media/js/main.js"></script>
      <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-46515756-1']);
        _gaq.push(['_trackPageview']);
        (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.x (<a href="http://orgmode.org">Org mode</a> 8.x)</p>
        <p>
          Copyright &copy; 2012 - 2014 <a href="mailto:changwei &lt;dot&gt; cn &lt;at&gt; gmail &lt;dot&gt; com">Will Chang</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/kelvinh/org-page" target="_blank">org-page</a>
        </p>
      </div>
    </div>
  </body>
</html>
